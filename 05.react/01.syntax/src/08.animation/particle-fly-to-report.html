<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Multi-Button Particle Animation</title>
    <style>
      body {
        font-family: sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #1a1a2e;
        overflow: hidden;
      }
      #target-a {
        position: absolute;
        top: 100px;
        left: 10%;
        width: 100px;
        height: 100px;
        background-color: #e94560;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        font-weight: bold;
        box-shadow: 0 0 20px #e94560;
      }

      /* 1. 공통 버튼 스타일 */
      .particle-source {
        position: absolute;
        padding: 20px 40px;
        background-color: #16213e;
        border: 2px solid #0f3460;
        color: white;
        border-radius: 10px;
        cursor: pointer;
        font-size: 1.2rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        transition: transform 0.2s;
      }
      .particle-source:hover {
        transform: scale(1.05);
      }

      /* 개별 버튼 위치 */
      #source-a {
        top: 200px;
        left: 30%;
      }
      #source-b {
        top: 300px;
        left: 30%;
      }
      #source-c {
        top: 400px;
        left: 30%;
      }
      #source-d {
        top: 500px;
        left: 30%;
      }

      #particle-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        pointer-events: none;
      }
      .particle {
        position: absolute;
        width: 20px;
        height: 20px;
        pointer-events: none;
      }
      .spark {
        width: 10px;
        height: 10px;
        background: radial-gradient(circle, #f9f871, transparent 60%);
        border-radius: 50%;
      }
      .star::before {
        content: "★";
        font-size: 20px;
        color: #1890ff;
        text-shadow: 0 0 10px #99c3ed;
      }
      .emoji::before {
        font-size: 20px;
      }
    </style>
  </head>
  <body>
    <div id="target-a">A (목표)</div>
    <button id="source-a" class="particle-source">A (클릭!)</button>
    <button id="source-b" class="particle-source">B (클릭!)</button>
    <button id="source-c" class="particle-source">C (클릭!)</button>
    <button id="source-d" class="particle-source">D (클릭!)</button>
    <div id="particle-container"></div>

    <script>
      const targetA = document.getElementById("target-a");
      // 3. 공통 클래스로 모든 버튼을 한 번에 선택
      const sources = document.querySelectorAll(".particle-source");
      const particleContainer = document.getElementById("particle-container");

      const PARTICLE_COUNT = 30;
      const SHAPES = ["star", "emoji"];
      const EMOJIS = ["✦", "⁺", "⋆"];

      // 4. forEach를 사용해 각 버튼에 이벤트 리스너 추가
      sources.forEach((source) => {
        source.addEventListener("click", (event) => {
          // 5. event.currentTarget으로 클릭된 바로 그 버튼을 가리킴
          const clickedButton = event.currentTarget;

          const rectA = targetA.getBoundingClientRect();
          const rectB = clickedButton.getBoundingClientRect(); // 클릭된 버튼의 좌표

          const targetX = rectA.left + rectA.width / 2;
          const targetY = rectA.top + rectA.height / 2;
          const startX = rectB.left + rectB.width / 2;
          const startY = rectB.top + rectB.height / 2;

          for (let i = 0; i < PARTICLE_COUNT; i++) {
            createAndAnimateParticle(startX, startY, targetX, targetY);
          }
        });
      });

      function createAndAnimateParticle(startX, startY, targetX, targetY) {
        const particle = document.createElement("div");
        const randomShape = SHAPES[Math.floor(Math.random() * SHAPES.length)];
        particle.classList.add("particle", randomShape);

        if (randomShape === "emoji") {
          const randomEmoji = EMOJIS[Math.floor(Math.random() * EMOJIS.length)];
          particle.innerHTML = randomEmoji;
        }

        const pSize = randomShape === "spark" ? 10 : 20;
        particle.style.left = `${startX - pSize / 2}px`;
        particle.style.top = `${startY - pSize / 2}px`;
        particleContainer.appendChild(particle);

        const controlX = startX + (Math.random() - 0.5) * 200;
        const controlY = startY + (Math.random() - 0.5) * 200;
        const randomRotation = (Math.random() - 0.5) * 720;

        const animation = particle.animate(
          [
            { transform: `translate(0, 0) scale(1) rotate(0deg)`, opacity: 1 },
            {
              transform: `translate(${controlX - startX}px, ${
                controlY - startY
              }px) scale(1.5) rotate(${randomRotation / 2}deg)`,
              opacity: 0.8,
              offset: 0.5,
            },
            {
              transform: `translate(${targetX - startX}px, ${
                targetY - startY
              }px) scale(0) rotate(${randomRotation}deg)`,
              opacity: 0.5,
            },
          ],
          {
            duration: 800 + Math.random() * 500,
            easing: "ease-in-out",
            delay: Math.random() * 200,
            fill: "forwards",
          }
        );

        animation.onfinish = () => {
          particle.remove();
        };
      }
    </script>
  </body>
</html>
